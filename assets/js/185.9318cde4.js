(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{1e3:function(s,a,n){"use strict";n.r(a);var e=n(17),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"koa2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2"}},[s._v("#")]),s._v(" koa2")]),s._v(" "),n("h2",{attrs:{id:"什么是框架-类比vue"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是框架-类比vue"}},[s._v("#")]),s._v(" 什么是框架（类比vue）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("封装原生代码的API\n规范流程和格式\n让开发人员更加关注于业务\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"框架frame和库lib的区别-类比vue和lodash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#框架frame和库lib的区别-类比vue和lodash"}},[s._v("#")]),s._v(" 框架frame和库lib的区别（类比vue和lodash）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("框架是唯一的，一个项目只能一个框架，库可以共存\n框架关注全流程，库关注单个功能\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"koa2介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2介绍"}},[s._v("#")]),s._v(" koa2介绍")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("是nodejs web server框架\n通过async/await语法搞笑编写web server\n中间件机制，能合理拆分业务代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"koa的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa的使用"}},[s._v("#")]),s._v(" koa的使用")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("npm init -y\ncnpm i koa -S\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("blockquote",[n("p",[s._v("在 index.js ：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\n\napp.use(async (context, next) => {\n    context.body = 'hello'\n})\n\napp.listen(3000)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"看源码的步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#看源码的步骤"}},[s._v("#")]),s._v(" 看源码的步骤")]),s._v(" "),n("blockquote",[n("p",[s._v("比如要看koa的源码")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1.去node_modules下面找koa文件夹\n2.先看readme.md \n3.看history.md (了解)\n4.看package.json ，搜索  main ,就是入口文件，要是没有入口文件，就默认是index.js\n5.看入口文件\n6.看源码，利用删减法，不要一上来就盯着细节看\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"koa-环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-环境搭建"}},[s._v("#")]),s._v(" koa 环境搭建")]),s._v(" "),n("blockquote",[n("p",[s._v("使用脚手架 koa-generator 创建koa2项目")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("npm i -g koa-generator\nkoa2 --version\nkoa2 test4    创建项目 名字为test4\ncd test4\nnpm install \nnpm run dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("blockquote",[n("p",[s._v("访问 3000 端口")])]),s._v(" "),n("h2",{attrs:{id:"文件夹的介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件夹的介绍"}},[s._v("#")]),s._v(" 文件夹的介绍")]),s._v(" "),n("blockquote",[n("p",[s._v("在app.js 中 ：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// error handler 错误处理器\nonerror(app)\n\n// middlewares 中间件 app.use(...)\napp.use(bodyparser({   // request的body转换\n  enableTypes:['json', 'form', 'text']\n}))\napp.use(json()) \napp.use(logger())  // 日志格式\n// 静态文件服务，表示当前同级文件 的 public文件夹 下面的所有的文件 都可以直接在浏览器url，\n// 输入路径，直接访问：比如 localhost:3000/images/1.jpg\napp.use(require('koa-static')(__dirname + '/public'))  \n\napp.use(views(__dirname + '/views', {   // 服务端模板引擎\n  extension: 'pug'\n}))\n\n// logger 打印当前请求花费的时间  next 就是当前这个中间件的下一个中间件\napp.use(async (ctx, next) => {\n  const start = new Date()\n  await next()\n  const ms = new Date() - start\n  console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)\n})\n\n// routes  注册路由\n// allowedMethods 对于404 或者返回时为空的情况的一种补充\napp.use(index.routes(), index.allowedMethods())\napp.use(users.routes(), users.allowedMethods())\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("blockquote",[n("p",[s._v("在routes / users.js :")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.prefix('/users')    // 前缀\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"koa2-处理http请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2-处理http请求"}},[s._v("#")]),s._v(" koa2 处理http请求")]),s._v(" "),n("blockquote",[n("p",[s._v("ctx是req和res的集合")])]),s._v(" "),n("blockquote",[n("p",[s._v("前端 发送请求 ：localhost:3000/list?a=100&b=200")])]),s._v(" "),n("blockquote",[n("p",[s._v("举例 ：有这么个路由")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.get('/list', async (ctx, next)=> {\n    const query = ctx.query  // 其实就是querystring ，res功能\n    console.log(query)   // {a:100,b:200}\n    ctx.body = 'this is a users response!'  // res功能\n})\n\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("blockquote",[n("p",[s._v("举例 ：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.post('/test', async (ctx, next)=> {\n    const body = ctx.request.body\n    console.log(body)   // \n     // ctx.body = 'this is a users response!'  // res功能\n     ctx.body = {   // 返回json格式\n        status:200,\n        data:{\n            a:1,\n            b:2\n        }\n        \n     }\n})\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("blockquote",[n("p",[s._v("去postman测试 发送json格式")])]),s._v(" "),n("h2",{attrs:{id:"koa2中间件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2中间件"}},[s._v("#")]),s._v(" koa2中间件")]),s._v(" "),n("blockquote",[n("p",[s._v("什么是中间件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1.一个流程上，独立的业务模块\n2.可扩展，可插拔\n3.类似于工厂的流水线\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("blockquote",[n("p",[s._v("为什么使用中间件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1.拆分业务模块，使代码清晰\n2.统一使用中间件，使得各业务代码都规范标准\n3.扩展性好，易添加，易删除\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("blockquote",[n("p",[s._v("一个http请求流程 :")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("req--\x3e bodyparser中间件 --\x3e json中间件 ---\x3e logger中间件 ---\x3e static中间件 --\x3eviews中间件 --\x3e自定义log---\x3e routes中间件 ---\x3e res\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("blockquote",[n("p",[s._v("注意：其实routes也是中间件，只不过要按照router的规则走")])]),s._v(" "),n("h2",{attrs:{id:"koa2洋葱圈模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2洋葱圈模型"}},[s._v("#")]),s._v(" koa2洋葱圈模型")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("中间件机制，是koa2的精髓\n每个中间件都是async函数\n中间件的运行机制，就像洋葱圈\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("blockquote",[n("p",[s._v("备注 ：注册中间件的时候，并不会调用中间件，需要访问的时候才会执行中间件")])]),s._v(" "),n("blockquote",[n("p",[s._v("代码演示 中间件的洋葱圈")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const Koa = require('koa')\n\nconst app = new Koa()\n\n// logger\napp.use(async (ctx, next) => {\n    await next() // 执行下一个中间件  \n    const rt = ctx.response.get('X-Response-Time')\n    console.log(`${ctx.method}---${ctx.url}----${rt}`)\n})\n\n// x-response-time \napp.use(async (ctx, next) => {\n    const start = Date.now()  \n    await next()   // 执行下一个中间件 \n    const ms = Date.now() - start   // 计算时间差 \n    ctx.set('X-Response-Time',`${ms} ms`)   // 记录时间差,这里的ms不能写成中的【毫秒】\n})\n\n// response\napp.use(async (ctx, next) => {\n    ctx.body = \"hello world\"\n})\n\napp.listen(3001)\nconsole.log('koa2 已经监听3001端口')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("blockquote",[n("p",[s._v("然后地址栏  输入 http://localhost:3001/index.html")])]),s._v(" "),n("h2",{attrs:{id:"cookie是啥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie是啥"}},[s._v("#")]),s._v(" cookie是啥")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("存储在浏览器的一段字符串，最大5kb\n每个域都有一个cookie，跨域不共享\n格式如 k1=v1;k2=v2; (可结构化)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("备注 ：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("每次http请求，cookie都会随着传递到服务端\n服务端可以修改cookie 再返回给前端\n默认，跨域不可以传递cookie\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"使用node原生服务端操作-cookie"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用node原生服务端操作-cookie"}},[s._v("#")]),s._v(" 使用node原生服务端操作 cookie")]),s._v(" "),n("blockquote",[n("p",[s._v("步骤 ：设置cookie  获取cookie  结构化cookie")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const http = require('http')\n\nconst server = http.createServer((req, res) => {\n    // 设置cookie\n    res.setHeader('Set-Cookie', 'a=400')\n    res.end('cookie test')\n\n    // 获取cookie \n    const cookieStr = req.headers.cookie\n    console.log('cookie is ', cookieStr)\n\n    // 结构化 cookie\n    // 假如 cookieStr 为 'a=100; b=200' ---转换为 --》 {a:100, b:200}\n    const cookieObg = {}\n    cookieStr.split(';').forEach(cookieItemStr => {\n        const arr = cookieItemStr.trim().split('=')\n        const key = arr[0] //'a'\n        const val = arr[1] // '100'\n        cookieObg[key] = val\n    })\n    console.log('cookie obj is ', cookieObg)\n})\n\nserver.listen(3002)\nconsole.log('监听3002 端口成功')\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h2",{attrs:{id:"koa2-操作-cookie"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2-操作-cookie"}},[s._v("#")]),s._v(" koa2 操作 cookie")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\n\napp.use(async (ctx) => {\n    // 设置cookie \n    ctx.cookies.set('a', '100')\n\n    // 获取cookie\n    console.log('cookie is ', ctx.cookies.get('a'))\n\n    // 结构化，koa2已经做好了\n    ctx.body = 'hello'\n})\n\napp.listen(3008)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"cookie-如何用于登录校验"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-如何用于登录校验"}},[s._v("#")]),s._v(" cookie 如何用于登录校验")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("前端请求登录接口，成功则设置cookie，如user='xxx'\n前端再次请求其他接口，就会带着上述的cookie\n服务端判断对应的cookie有无，进行验证\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("注意 : cookie里面不能有用户的信息,cookie存放用户信息明文，非常危险")])]),s._v(" "),n("blockquote",[n("p",[s._v("解决方案：cookie存放用户标识")])]),s._v(" "),n("h2",{attrs:{id:"小案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小案例"}},[s._v("#")]),s._v(" 小案例")]),s._v(" "),n("blockquote",[n("p",[s._v("使用koa2实现   查看访问页面次数 ( 在koa2脚手架的环境下 )")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("使用npm 插件 koa-generic-session\n使用ctx.session\n模拟登录\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("首先安装")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("npm i koa-generic-session --save \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("在app.js ：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const session = require('koa-generic-session')\napp.use(session())\n// 密钥\napp.keys = ['seesion-koa2']\n// 使用下面的中间件，就会自动配置关联session 和 cookie之间的关系\napp.use(session({\n  // 配置cookie\n  // cookie 在跟目录下面的所有的目录都有效 ，比如:localhost:3008/api/list  , api/list 这个目录也是跟目录下的\n  path: '/',   \n  httpOnly: true,  // cookie只允许服务端来操作\n  maxAge: 24 * 60 * 60 * 1000  // cookie的有效期 单位时毫秒\n}))\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("blockquote",[n("p",[s._v("在 routes/index.js :")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.get('/session-test', async (ctx, next) => {\n  if (ctx.session.viewcount == null) {\n    // 用户尚未访问\n    ctx.session.viewcount = 0\n  }\n  // 用户已经访问过了\n  ctx.session.viewcount++\n\n  ctx.body = {\n    title: 'session-test',\n    viewcount: ctx.session.viewcount\n  }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("blockquote",[n("p",[s._v("访问:")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http://localhost:3000/session-test\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("补充 ：获取参数")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("get请求 ：ctx.query\npost请求 : ctx.request.body\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"koa2实现登录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa2实现登录"}},[s._v("#")]),s._v(" koa2实现登录")]),s._v(" "),n("blockquote",[n("p",[s._v("有两种情况：")])]),s._v(" "),n("blockquote",[n("p",[s._v("1。直接请求 /login ，也就是直接去登录,配合使用 sequelize ,创建User模型等操作。。。")])]),s._v(" "),n("blockquote",[n("p",[s._v("在routes/users.js   :")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("router.get('/login', async (ctx, next) => {\nconst {\n    username,\n    password\n} = ctx.query\n\nconst user = await User.findOne({\n    where: {\n    userName: username,\n    password\n    }\n})\nif (user != null) {\n    // 登录成功，设置session\n    ctx.session.userInfo = user\n    // 返回\n    ctx.body = {\n    status: 200,\n    data: user\n    }\n    return   //注意一定要 return\n}\n\n// 登录失败\nctx.body = {\n    staus: -1,\n    message: '用户名字或者密码错误'\n}\n})\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("blockquote",[n("p",[s._v("2.请求 商品列表，/list  是需要登录成功,才能请求成功,\n这时候就需要定义登录中间件")])]),s._v(" "),n("blockquote",[n("p",[s._v("在middlewares/loginCheck.js :")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 登录验证的中间件\nasync function loginCheck(ctx, next) {\n    const userInfo = ctx.session.userInfo\n    if (userInfo && userInfo.userName) {\n        // 登录验证成功\n        await next()\n        return\n    }\n    // 登录失败\n    ctx.body = {\n        errno: -1,\n        message: '请登录'\n    }\n}\nmodule.exports = loginCheck\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);